<!DOCTYPE html>
<html lang="de" data-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>INNO-SCREW ‚Äî Demo</title>
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî©</text></svg>"/>
  <style>
    .demo-big {
      background: var(--card-bg); border: 1px solid var(--border);
      border-radius: var(--radius); padding: 2rem; box-shadow: var(--shadow);
    }
    .sim-controls { display:flex; gap:.75rem; flex-wrap:wrap; margin-bottom:1.5rem; }
    .sim-btn {
      padding:.55rem 1.2rem; border-radius:7px; border:none; font-weight:600;
      cursor:pointer; font-size:.88rem; transition:.2s;
    }
    .sim-btn-primary { background:var(--accent); color:#fff; }
    .sim-btn-primary:hover { background:var(--accent-light); }
    .sim-btn-secondary { background:var(--bg-alt); color:var(--text); border:1px solid var(--border); }
    .sim-btn-secondary:hover { background:var(--border); }
    .sim-btn-danger { background:#c0392b; color:#fff; }
    .sim-btn-danger:hover { background:#e74c3c; }

    .signal-display {
      height:160px; border-radius:8px; background:var(--bg-alt);
      border:1px solid var(--border); position:relative; overflow:hidden;
      display:flex; align-items:center; margin-bottom:1rem;
    }
    canvas#signal-canvas { width:100%; height:100%; }

    .result-badge {
      display:inline-flex; align-items:center; gap:.5rem; padding:.5rem 1.1rem;
      border-radius:20px; font-weight:700; font-size:.88rem; transition:.4s;
    }
    .badge-ok   { background:#e8f8f0; color:#1a7040; border:1px solid #82d9b0; }
    .badge-nok  { background:#fdf0ed; color:#922b21; border:1px solid #f5a89a; }
    .badge-idle { background:var(--bg-alt); color:var(--text-muted); border:1px solid var(--border); }

    .param-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:1rem; margin-top:1.5rem; }
    .param-box {
      background:var(--bg-alt); border:1px solid var(--border);
      border-radius:8px; padding:1rem; text-align:center;
    }
    .param-box .val { font-size:1.6rem; font-weight:800; color:var(--accent); }
    .param-box .lbl { font-size:.78rem; color:var(--text-muted); margin-top:.2rem; }

    .station-tabs { display:flex; gap:.5rem; margin-bottom:1.5rem; flex-wrap:wrap; }
    .station-tab {
      padding:.4rem 1rem; border-radius:6px; border:1px solid var(--border);
      background:var(--bg-alt); color:var(--text-muted); cursor:pointer;
      font-size:.85rem; font-weight:600; transition:.2s;
    }
    .station-tab.active, .station-tab:hover {
      background:var(--accent); color:#fff; border-color:var(--accent);
    }

    .log-panel {
      background:var(--bg-alt); border:1px solid var(--border);
      border-radius:8px; padding:1rem; font-family:monospace;
      font-size:.8rem; height:120px; overflow-y:auto; color:var(--text-muted);
    }
    .log-ok  { color:#1a7040; } .log-nok { color:#c0392b; } .log-info { color:var(--accent-light); }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-inner">
    <a href="index.html" class="nav-brand">
      <div class="logo-mark">IS</div>
      <span>INNO-SCREW</span>
    </a>
    <ul class="nav-links" id="nav-links">
      <li><a href="index.html"        data-i18n="nav_home">Start</a></li>
      <li><a href="about.html"        data-i18n="nav_about">√úber uns</a></li>
      <li><a href="demo.html"         data-i18n="nav_demo">Demo</a></li>
      <li><a href="publications.html" data-i18n="nav_pub">Publikationen</a></li>
      <li><a href="contact.html"      data-i18n="nav_contact">Kontakt</a></li>
    </ul>
    <div class="nav-controls">
      <button class="btn-lang" id="btn-lang">EN</button>
      <button class="btn-theme" id="btn-theme">üåô</button>
      <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
    </div>
  </div>
</nav>

<!-- PAGE HEADER -->
<div class="page-header">
  <h1>Interaktive Demo</h1>
  <p>Simulieren Sie einen Schraubvorgang und erleben Sie die ML-Anomalieerkennung in Echtzeit</p>
</div>

<!-- DEMO OVERVIEW -->
<section>
  <div class="section-inner">
    <div style="display:grid; grid-template-columns:1fr 1fr; gap:2.5rem; align-items:start;">

      <!-- Simulator -->
      <div>
        <div class="section-header" style="text-align:left; margin-bottom:1.5rem;">
          <h2 style="display:inline-block;">Schrauben-Simulator</h2>
        </div>

        <div class="station-tabs" id="station-tabs">
          <div class="station-tab active" data-station="auto">ü§ñ Automatisch</div>
          <div class="station-tab" data-station="robot">ü¶æ Roboter</div>
          <div class="station-tab" data-station="manual">üë∑ Manuell</div>
          <div class="station-tab" data-station="wireless">üì° Kabellos</div>
        </div>

        <div class="demo-big">
          <div class="sim-controls">
            <button class="sim-btn sim-btn-primary" id="btn-run">‚ñ∂ Fehlerfreier Vorgang</button>
            <button class="sim-btn sim-btn-danger"  id="btn-fault">‚ö† Manipuliert (Fehler)</button>
            <button class="sim-btn sim-btn-secondary" id="btn-reset">‚Ü∫ Reset</button>
          </div>

          <div class="signal-display">
            <canvas id="signal-canvas"></canvas>
          </div>

          <div style="display:flex; align-items:center; gap:1rem; flex-wrap:wrap;">
            <span id="result-badge" class="result-badge badge-idle">‚è≥ Bereit / Ready</span>
            <span id="confidence-text" style="font-size:.82rem; color:var(--text-muted);"></span>
          </div>

          <div class="param-grid">
            <div class="param-box">
              <div class="val" id="param-torque">‚Äî</div>
              <div class="lbl">Drehmoment (Nm)</div>
            </div>
            <div class="param-box">
              <div class="val" id="param-angle">‚Äî</div>
              <div class="lbl">Drehwinkel (¬∞)</div>
            </div>
            <div class="param-box">
              <div class="val" id="param-time">‚Äî</div>
              <div class="lbl">Zeit (ms)</div>
            </div>
            <div class="param-box">
              <div class="val" id="param-score">‚Äî</div>
              <div class="lbl">Anomalie-Score</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Log -->
      <div>
        <div class="section-header" style="text-align:left; margin-bottom:1.5rem;">
          <h2 style="display:inline-block;">Protokoll / Log</h2>
        </div>
        <div class="demo-big">
          <div class="log-panel" id="log-panel">
            <div class="log-info">[SYSTEM] INNO-SCREW Anomaly Detection Engine v1.0 initialisiert</div>
            <div class="log-info">[SYSTEM] Modell geladen: IsolationForest + LSTM-Autoencoder</div>
            <div class="log-info">[READY] Warten auf Schraubvorgang‚Ä¶</div>
          </div>
        </div>

        <div class="demo-big mt-1">
          <h3 style="font-size:1rem; font-weight:700; margin-bottom:.8rem;">‚ÑπÔ∏è √úber diese Demo</h3>
          <p style="font-size:.85rem; color:var(--text-muted); line-height:1.6;">
            Diese Demo simuliert die ML-Anomalieerkennung des INNO-SCREW-Systems. Das Drehmoment- und Winkelsignal wird in Echtzeit visualisiert. Ein <strong>Isolation Forest</strong> und ein <strong>LSTM-Autoencoder</strong> analysieren den Verlauf und geben einen Anomalie-Score aus.
          </p>
          <p style="font-size:.85rem; color:var(--text-muted); margin-top:.6rem;">
            This demo simulates the ML anomaly detection system. The torque and angle signal is visualized in real time. An Isolation Forest and LSTM Autoencoder analyze the signal curve and output an anomaly score.
          </p>
        </div>

        <div class="demo-big mt-1">
          <h3 style="font-size:1rem; font-weight:700; margin-bottom:.8rem;">üìà Stationsstatistik</h3>
          <div style="display:flex; flex-direction:column; gap:.4rem; font-size:.85rem;">
            <div style="display:flex; justify-content:space-between; padding:.4rem .6rem; background:var(--bg-alt); border-radius:5px;">
              <span>Analysierte Vorg√§nge</span> <strong id="stat-total">0</strong>
            </div>
            <div style="display:flex; justify-content:space-between; padding:.4rem .6rem; background:var(--bg-alt); border-radius:5px;">
              <span style="color:#1a7040;">‚úì IO (in Ordnung)</span> <strong id="stat-ok" style="color:#1a7040;">0</strong>
            </div>
            <div style="display:flex; justify-content:space-between; padding:.4rem .6rem; background:var(--bg-alt); border-radius:5px;">
              <span style="color:#c0392b;">‚úó NIO (nicht in Ordnung)</span> <strong id="stat-nok" style="color:#c0392b;">0</strong>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- HOW IT WORKS -->
<section style="background:var(--bg-alt);">
  <div class="section-inner">
    <div class="section-header">
      <h2>Wie funktioniert es?</h2>
      <p>Der dreistufige ML-Pipeline hinter INNO-SCREW</p>
    </div>
    <div class="cards">
      <div class="card">
        <div class="card-icon">üì°</div>
        <h3>1. Datenerfassung</h3>
        <p>Drehmoment- und Winkelsignale werden w√§hrend des Schraubvorgangs mit hoher Abtastrate erfasst und vorverarbeitet.</p>
      </div>
      <div class="card">
        <div class="card-icon">üß†</div>
        <h3>2. Merkmalsextraktion</h3>
        <p>Charakteristische Merkmale aus dem Zeitbereich und Frequenzbereich werden automatisch extrahiert und normiert.</p>
      </div>
      <div class="card">
        <div class="card-icon">‚ö°</div>
        <h3>3. Anomalieerkennung</h3>
        <p>Ensemble-Modell aus Isolation Forest und LSTM-Autoencoder klassifiziert jeden Vorgang in Echtzeit als IO oder NIO.</p>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer>
  <div class="footer-inner">
    <strong>INNO-SCREW</strong> ‚Äî RIF Institut f√ºr Forschung und Transfer e.V., Dortmund
    <div style="margin-top:.6rem; display:flex; gap:1rem; justify-content:center;">
      <a href="contact.html">Impressum</a>
      <a href="contact.html">Datenschutz</a>
    </div>
    <div class="footer-bottom">&copy; RIF e.V. 2025</div>
  </div>
</footer>

<script src="js/main.js"></script>
<script>
// ‚îÄ‚îÄ Demo simulation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const canvas = document.getElementById('signal-canvas');
const ctx    = canvas.getContext('2d');
let animId   = null;
let stats    = { total:0, ok:0, nok:0 };

function resize() {
  canvas.width  = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
window.addEventListener('resize', resize);
resize();

function drawSignal(points, color, isFault) {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const w = canvas.width, h = canvas.height;

  // Grid
  ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--border') || '#ddd';
  ctx.lineWidth = 1;
  for(let x=0; x<w; x+=40){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,h); ctx.stroke(); }
  for(let y=0; y<h; y+=30){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(w,y); ctx.stroke(); }

  if(points.length < 2) return;
  ctx.beginPath();
  ctx.strokeStyle = color;
  ctx.lineWidth = 2.5;
  ctx.lineJoin = 'round';
  points.forEach((p,i)=>{
    const x = (i/(points.length-1))*w;
    const y = h - (p/1.3)*h*0.8 - h*0.05;
    i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y);
  });
  ctx.stroke();

  // Fill
  ctx.lineTo(w,h); ctx.lineTo(0,h); ctx.closePath();
  ctx.fillStyle = isFault ? 'rgba(192,57,43,0.07)' : 'rgba(26,82,118,0.07)';
  ctx.fill();
}

function generateSignal(isFault) {
  const pts = [];
  for(let i=0; i<120; i++){
    const t = i/119;
    // normal screw torque curve: rise, plateau, drop
    let v = Math.pow(t,0.5) * Math.sin(t*2.8+0.5)*0.8 + 0.1;
    if(isFault){
      // Add anomalous spikes and drops
      if(i > 40 && i < 55) v += (Math.random()-0.3)*0.6;
      if(i > 80) v -= 0.25 + Math.random()*0.2;
    } else {
      v += (Math.random()-0.5)*0.04;
    }
    pts.push(Math.max(0,Math.min(1,v)));
  }
  return pts;
}

function log(msg, cls='log-info') {
  const panel = document.getElementById('log-panel');
  const div = document.createElement('div');
  div.className = cls;
  div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
  panel.appendChild(div);
  panel.scrollTop = panel.scrollHeight;
}

function updateStats() {
  document.getElementById('stat-total').textContent = stats.total;
  document.getElementById('stat-ok').textContent    = stats.ok;
  document.getElementById('stat-nok').textContent   = stats.nok;
}

function runSim(isFault) {
  if(animId) cancelAnimationFrame(animId);
  const badge = document.getElementById('result-badge');
  const conf  = document.getElementById('confidence-text');
  badge.className = 'result-badge badge-idle';
  badge.textContent = '‚è≥ Analysiere‚Ä¶';
  conf.textContent = '';

  const pts = generateSignal(isFault);
  let frame = 0;
  const color = isFault ? '#c0392b' : '#1a5276';

  const station = document.querySelector('.station-tab.active').textContent.trim();
  log(`[${station}] Schraubvorgang gestartet‚Ä¶`, 'log-info');

  // Fake params
  const torque  = isFault ? (3.2 + Math.random()*1.8).toFixed(1) : (8.1 + Math.random()*0.8).toFixed(1);
  const angle   = isFault ? (220 + Math.random()*80).toFixed(0)  : (365 + Math.random()*15).toFixed(0);
  const time    = (180 + Math.random()*60).toFixed(0);
  const score   = isFault ? (0.72 + Math.random()*0.25).toFixed(2) : (0.04 + Math.random()*0.12).toFixed(2);

  function step() {
    frame = Math.min(frame+3, pts.length);
    drawSignal(pts.slice(0,frame), color, isFault);
    if(frame < pts.length){ animId = requestAnimationFrame(step); return; }

    // Final result
    document.getElementById('param-torque').textContent = torque;
    document.getElementById('param-angle').textContent  = angle;
    document.getElementById('param-time').textContent   = time;
    document.getElementById('param-score').textContent  = score;

    stats.total++;
    if(isFault){
      badge.className = 'result-badge badge-nok';
      badge.textContent = '‚úó NIO ‚Äî Anomalie erkannt';
      conf.textContent = `Konfidenz: ${(parseFloat(score)*100).toFixed(0)}%`;
      stats.nok++;
      log(`[ML] ANOMALIE erkannt! Score: ${score}`, 'log-nok');
    } else {
      badge.className = 'result-badge badge-ok';
      badge.textContent = '‚úì IO ‚Äî Verschraubung in Ordnung';
      conf.textContent = `Konfidenz: ${((1-parseFloat(score))*100).toFixed(0)}%`;
      stats.ok++;
      log(`[ML] Vorgang IO. Anomalie-Score: ${score}`, 'log-ok');
    }
    updateStats();
  }
  requestAnimationFrame(step);
}

document.getElementById('btn-run').addEventListener('click',   ()=>runSim(false));
document.getElementById('btn-fault').addEventListener('click', ()=>runSim(true));
document.getElementById('btn-reset').addEventListener('click', ()=>{
  if(animId) cancelAnimationFrame(animId);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  document.getElementById('result-badge').className = 'result-badge badge-idle';
  document.getElementById('result-badge').textContent = '‚è≥ Bereit / Ready';
  document.getElementById('confidence-text').textContent = '';
  ['param-torque','param-angle','param-time','param-score'].forEach(id=>{ document.getElementById(id).textContent='‚Äî'; });
});

// Station tabs
document.querySelectorAll('.station-tab').forEach(tab=>{
  tab.addEventListener('click', ()=>{
    document.querySelectorAll('.station-tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    log(`[SYSTEM] Station gewechselt: ${tab.textContent.trim()}`, 'log-info');
  });
});

// Draw idle grid
setTimeout(()=>{ resize(); drawSignal([],''  ,false); }, 200);
</script>
</body>
</html>
